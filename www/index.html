<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <!--meta name="viewport" content="width=device-width"-->
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, target-densityDpi=device-dpi" />
  
  <meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0">
  <meta http-equiv="expires" content="Sat, 31 Oct 2014 00:00:00 GMT">
  <meta http-equiv="pragma" content="no-cache">

  <title>RoundTheCans</title>


</head>


<style>
 body {margin: 0}
 iframe {width: 100vw; border:none; height:100vh}
 </style>
 
 
<body onload="reload()">
<button onclick="reload()"> RELOAD</button>
<button onclick="BeGone()"> EXIT</button>
<button onclick="report()"> REPORT</button>
<div id=zz></div>
 <br><hr>

<div id=MyMainDiv> Please wait ... loading application </div>

<script>

var isrc = "http://localhost:8080/www/subindex.html";
var isrc = "subindex.html";

if (location.href.split("/")[4] != "Work") {
	// running on device, fetch subindex from bucket
	var isrc = "https://firebasestorage.googleapis.com/v0/b/roundthecans-1a.appspot.com/o/subindex.html?alt=media";
	}

function BeGone() {
if (!navigator) alert('No Nav');
if (!navigator.app) alert('No App');
navigator.app.exitApp();
}


function reload() {
    window.onerror = function (msg, url, line, col, err) {zz.innerHTML = msg};
    MyMainDiv.innerHTML="empty";
	setTimeout(reload2, 500);
	}
	
function reload2() {
    MyMainDiv.innerHTML = "Now really loading application";
	setTimeout(reload3, 500);
	}
	
function reload3() {
    MyMainDiv.innerHTML= "<iframe id=MyIframe src='" + isrc + "' allow='geolocation; microphone; camera'></iframe>";
	}
	
// When local, location.href is file:///C:/Work/PhoneGap/RoundTheCans/www/index.html	
// when in app, is file:///var/mobile/Containers/Data/Application ... etc
function report() {
	CW.postMessage("LOG:Yeppers", "*");  
	}	
	
	
	
addEventListener("message", function(event) {
  var msg= event.data.split(":")[0];
  var param= event.data.split(":").slice(1).join(":");
  //if (msg=="LOG") log(param);
  if (msg == "ALERT") alert("PARENT GOT " + param)
  if (msg == "READY") {
		console.log("parent received ready")
	    CW = document.getElementById("MyIframe").contentWindow;
		CW.postMessage("BASE:"+location.href, "*");  
		}

  });
	
  </script>
  


</body>
</html>